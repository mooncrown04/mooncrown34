# .github/workflows/app.yaml dosyanÄ±zÄ±n doÄŸru iÃ§eriÄŸi
name: Python M3U Generator CI/CD

# Hangi olaylarda Ã§alÄ±ÅŸacaÄŸÄ±nÄ± tanÄ±mla
on:
  push:
    branches: [ main ] # Sadece 'main' dalÄ±na yapÄ±lan push iÅŸlemlerinde Ã§alÄ±ÅŸÄ±r
  pull_request:
    branches: [ main ]

# Ä°ÅLER (JOBS) baÅŸlar - Gerekli anahtar
jobs:
  build: # Ä°ÅŸin adÄ± (isteÄŸe baÄŸlÄ±)
    runs-on: ubuntu-latest # Ä°ÅŸin Ã§alÄ±ÅŸacaÄŸÄ± iÅŸletim sistemi

    steps:
    # 1. KodlarÄ± Ã§ek
    - name: Kodu Ã‡ek ğŸ“¦
      uses: actions/checkout@v4 

    # 2. Python OrtamÄ±nÄ± Kur
    - name: Python Kurulumu ğŸ
      uses: actions/setup-python@v4
      with:
        python-version: '3.10' 

    # 3. BaÄŸÄ±mlÄ±lÄ±klarÄ± YÃ¼kle
    - name: BaÄŸÄ±mlÄ±lÄ±klarÄ± YÃ¼kle (Flask, requests) ğŸ› ï¸
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt # requirements.txt dosyanÄ±z olmalÄ±

    # 4. DaÄŸÄ±tÄ±m AdÄ±mÄ± (Deployment)
    # Bu adÄ±m, kodunuzu sunucunuzda (VSP/DigitalOcean/Ã¶zel sunucu) Ã§alÄ±ÅŸtÄ±rmalÄ±dÄ±r.
    # Ã–rnekte, dosyalarÄ± SCP/SSH ile sunucuya kopyalayarak otomatik daÄŸÄ±tÄ±m yapÄ±yoruz.
    - name: Sunucuya DaÄŸÄ±tma (Ã–rnek) ğŸš€
      uses: appleboy/ssh-action@master # Bu, SSH Ã¼zerinden dosya kopyalamak iÃ§in popÃ¼ler bir 'action'dÄ±r.
      with:
        host: ${{ secrets.SSH_HOST }}        # Gizli anahtar olarak tanÄ±mlanan sunucu adresi
        username: ${{ secrets.SSH_USERNAME }}  # Gizli anahtar olarak tanÄ±mlanan kullanÄ±cÄ± adÄ±
        key: ${{ secrets.SSH_PRIVATE_KEY }}   # Gizli anahtar olarak tanÄ±mlanan SSH anahtarÄ±
        # Python projenizin olduÄŸu klasÃ¶re kopyalama iÅŸlemi
        script: |
          cd /var/www/html/iptv_m3u_api # Sizin sunucunuzdaki klasÃ¶r yolu
          git pull origin main # En gÃ¼ncel kodu sunucuda Ã§ek
          # UygulamayÄ± yeniden baÅŸlatma komutu (Gerekliyse: gunicorn, systemctl restart, vb.)
          # service m3u_service restart
