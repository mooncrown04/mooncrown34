# .github/workflows/app.yaml dosyanÄ±zÄ±n DOÄRU iÃ§eriÄŸi

name: Python M3U Generator CI/CD

# Hangi olaylarda Ã§alÄ±ÅŸacaÄŸÄ±nÄ± tanÄ±mla
on:
  push:
    branches: [ main ] # Sadece 'main' dalÄ±na yapÄ±lan push iÅŸlemlerinde Ã§alÄ±ÅŸÄ±r
  pull_request:
    branches: [ main ]

# Ä°ÅLER (JOBS) baÅŸlar - Gerekli anahtar
jobs:
  build_and_deploy: # Ä°ÅŸin adÄ±
    runs-on: ubuntu-latest # Ä°ÅŸin Ã§alÄ±ÅŸacaÄŸÄ± iÅŸletim sistemi

    steps:
    # 1. KodlarÄ± Ã§ek
    - name: Kodu Ã‡ek (Checkout) ğŸ“¦
      uses: actions/checkout@v4 

    # 2. Python OrtamÄ±nÄ± Kur
    - name: Python Kurulumu ğŸ
      uses: actions/setup-python@v4
      with:
        python-version: '3.10' # Kullanmak istediÄŸiniz Python versiyonu

    # 3. BaÄŸÄ±mlÄ±lÄ±klarÄ± YÃ¼kle (requirements.txt dosyasÄ± gereklidir)
    - name: BaÄŸÄ±mlÄ±lÄ±klarÄ± YÃ¼kle (Flask, requests) ğŸ› ï¸
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt 

    # 4. DaÄŸÄ±tÄ±m AdÄ±mÄ± (Deployment) - Bu adÄ±m, sizin Ã¶zel sunucunuzla senkronizasyon saÄŸlar.
    # Bu adÄ±mÄ± kullanabilmek iÃ§in GitHub > Settings > Secrets bÃ¶lÃ¼mÃ¼ne SSH bilgilerinizi (SSH_HOST, SSH_USERNAME, SSH_PRIVATE_KEY) eklemelisiniz.
    - name: Sunucuya DaÄŸÄ±tma (Otomatik SSH/Git Pull) ğŸš€
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.SSH_HOST }}
        username: ${{ secrets.SSH_USERNAME }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        script: |
          # Sunucudaki projenizin olduÄŸu klasÃ¶re git
          cd /var/www/html/iptv_m3u_api 
          # GitHub'daki en gÃ¼ncel kodu sunucuda Ã§ek
          git pull origin main 
          # UygulamayÄ± yeniden baÅŸlatma komutu (gunicorn'Ä± veya Python servisini yeniden baÅŸlatÄ±r)
          # Ã–rnek: sudo systemctl restart gunicorn_m3u_service
          echo "Deployment tamamlandÄ±. Servis yeniden baÅŸlatÄ±lÄ±yor..."
